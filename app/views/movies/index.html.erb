<h1 align="center">Movies</h1>

<p align="center">
  <%=
    field_options = @genre_id ? { selected: @genre_id, include_blank: '(No genre)' } : { prompt: '(No genre)' }

    collection_select(
      :movie, :genre_id, @genres, :id, :name,
      field_options,
      { onchange: "document.location = '/movies?genre_id=' + this.value + '&sorting_field=' + sorting_field.value" }
    )
  %>
  <%#
    In a strictly secure environment, we wouldn't give away a "field", because an attacker
    would get pieces of the db structure. In this context, it doesn't matter.
  %>
  <%=
    field_options = @sorting_field ? { include_blank: '(No sorting)' } : { prompt: '(No sorting)' }

    select_tag(
      :sorting_field, options_for_select( @sort_mapping, @sorting_field ),
      field_options.merge( onchange: "document.location = '/movies?genre_id=' + movie_genre_id.value + '&sorting_field=' + this.value" )
    )
  %>
</p>

<table width="100%" cellpadding="5" border="1">
  <% @movies.each_slice( 3 ) do | movies_row | %>
  <tr>
    <% movies_row.each do | movie | %>
	    <td width="33%" align="center" valign="center">
	      <%= image_tag url_for( controller: 'posters', action: 'show', movie_id: movie.id ) %>
	      <br/>
	      <%= h( movie.title ) %>
	    </td>
    <% end %>
  </tr>
  <% end %>
</table>

<p align="center">
  <%= link_to_next_page @movies, 'Previous page' %> <%= link_to_next_page @movies, 'Next page' %>
</p>
